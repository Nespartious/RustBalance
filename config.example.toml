# RustBalance Configuration Example
# Copy to /etc/rustbalance/config.toml and customize

# ============================================================
# ROOT-LEVEL SETTINGS (must appear before any [section] headers)
# ============================================================

# Local port for hidden service connections (Tor forwards here)
local_port = 8080

# Directory where Tor stores hidden service keys/hostname
# Must be readable by Tor user (debian-tor on Ubuntu)
# IMPORTANT: Use /var/lib/tor/ to work with AppArmor policies
hidden_service_dir = "/var/lib/tor/rustbalance_hs"

# ============================================================
# NODE IDENTITY
# ============================================================

[node]
id = "node-a"
priority = 10
clock_skew_tolerance_secs = 5

# ============================================================
# MASTER ONION ADDRESS
# ============================================================

[master]
# The public .onion address clients will connect to
# This address is derived from the identity key below
onion_address = "yourmasteronionaddress1234567890abcdefghijklmno.onion"
# Path to the master Ed25519 identity key
# Can be 32-byte seed (will be auto-converted) or 96-byte Tor format
identity_key_path = "/etc/rustbalance/master.key"

# ============================================================
# TARGET SERVICE (the actual app we reverse proxy to)
# ============================================================

[target]
# The target service we reverse proxy to
# This is the actual application - never shared publicly
onion_address = "YOUR_TARGET_SERVICE.onion"
port = 80

[tor]
control_host = "127.0.0.1"
control_port = 9051
socks_port = 9050

[publish]
refresh_interval_secs = 600
takeover_grace_secs = 90
max_intro_points = 20

[health]
descriptor_max_age_secs = 900
http_probe_enabled = false
http_probe_path = "/health"
http_probe_timeout_secs = 5

[coordination]
mode = "wireguard"
heartbeat_interval_secs = 10
heartbeat_timeout_secs = 30
lease_duration_secs = 60
backoff_jitter_secs = 15
# Cluster token for peer authentication (generated on first node, shared to joining nodes)
# cluster_token = "YOUR_CLUSTER_TOKEN"

[wireguard]
interface = "wg-rb"
listen_port = 51820
tunnel_ip = "10.200.200.1"
private_key = "YOUR_PRIVATE_KEY_BASE64"
# Public key (derived from private key) - needed for PeerAnnounce
public_key = "YOUR_PUBLIC_KEY_BASE64"
# External endpoint for other nodes to connect (your public IP:port)
# external_endpoint = "YOUR_PUBLIC_IP:51820"
# Peers are optional - can start with none and add via gossip/peer announcements
# peers = []

[[wireguard.peers]]
id = "node-b"
endpoint = "192.168.40.143:51820"
tunnel_ip = "10.200.200.2"
public_key = "PEER_PUBLIC_KEY_BASE64"
